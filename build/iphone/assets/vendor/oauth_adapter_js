const SOCIALACCESSTOKEN="MultiSocial-AccessToken-Production";var OAuthAdapter=function(e,t,i,o){function r(){E||(E=!0,w.value=0,U=P?"tokenRequest":"pageLoad",O[U]||(O[U]=P?2e3:1e3),P=!1,L=(new Date).getTime(),_=setInterval(n,30),v&&v.hide(),w&&w.show(),A&&A.show())}function n(){w&&(w.value=((new Date).getTime()-L)/O[U])}function a(t){switch(e){case"linkedin":var i=t.source.evalJS('(p = document.getElementsByClassName("access-code")) && p[0].innerHTML');i?(d=i,x(),S()):(w&&w.hide(),A&&A.hide(),v&&v.show()),E=!1,clearInterval(_),O[U]=(new Date).getTime()-L,Ti.App.Properties.setString("Social-LoadingEstimates",JSON.stringify(O));break;case"twitter":var i=t.source.evalJS('(p = document.getElementById("oauth_pin")) && p.innerHTML;');i?(d=i.split("<code>")[1].split("</code>")[0],x(),S()):(w&&w.hide(),A&&A.hide(),v&&v.show()),E=!1,clearInterval(_),O[U]=(new Date).getTime()-L,Ti.App.Properties.setString("Social-LoadingEstimates",JSON.stringify(O));break;case"xing":var i=t.source.evalJS('(p = document.getElementById("verifier")) && p.innerHTML;');i?(d=i,x(),S()):(w&&w.hide(),A&&A.hide(),v&&v.show()),E=!1,clearInterval(_),O[U]=(new Date).getTime()-L,Ti.App.Properties.setString("Social-LoadingEstimates",JSON.stringify(O))}}var s=t,c=i,l=o,d=null,u=null,h=null,T=null,g=null,m={consumerSecret:s,tokenSecret:""},f=null,I=null,v=null,w=null,A=null,S=null,k={};this.loadAccessToken=function(e){console.log(e);var t;if(k[e])t=k[e];else{var i=Ti.App.Properties.getString(SOCIALACCESSTOKEN+e,"");if(!i)return console.log("Warning: no SOCIALACCESSTOKEN in store"),void 0;try{t=k[e]=JSON.parse(i)}catch(o){return Ti.API.error("Failed to parse stored access token for "+e+"!"),Ti.API.error(o),void 0}}t.accessToken&&(T=t.accessToken),t.accessTokenSecret&&(g=t.accessTokenSecret)},this.saveAccessToken=function(e){k[e]={accessToken:T,accessTokenSecret:g},console.log(k),Ti.App.Properties.setString(SOCIALACCESSTOKEN+e,JSON.stringify(k[e]))},this.clearAccessToken=function(e){delete k[e],Ti.App.Properties.setString(SOCIALACCESSTOKEN+e,null),T=null,g=null},this.isAuthorized=function(){return null!=T&&null!=g};var y=function(e){var t={action:e,method:"POST",parameters:[]};return t.parameters.push(["oauth_consumer_key",c]),t.parameters.push(["oauth_callback","oob"]),t.parameters.push(["oauth_signature_method",l]),t},b=function(e){var t={action:e,method:"POST",parameters:[]};return t.parameters.push(["oauth_consumer_key",c]),t.parameters.push(["oauth_signature_method",l]),t};this.getPin=function(){return d},this.getRequestToken=function(e,t){m.tokenSecret="";var i=y(e);OAuth.setTimestampAndNonce(i),OAuth.SignatureMethod.sign(i,m);var o=!1,r=Ti.Network.createHTTPClient({onload:function(){var e=OAuth.getParameterMap(this.responseText);u=e.oauth_token,h=e.oauth_token_secret,t({success:!0,token:this.responseText}),o=!0},onerror:function(){Ti.API.error("Social.js: FAILED to getRequestToken!"),Ti.API.error(this.responseText),t({success:!1}),o=!0}});r.open("POST",e),r.send(OAuth.getParameterMap(i.parameters))};var U,L,x=function(){if(null!=f)try{v.removeEventListener("load",a),v.removeEventListener("beforeload",r),w.hide(),f.close(),E=null,v=null,w=null,E=!1,P=!0,I=null,f=null}catch(e){Ti.API.debug("Cannot destroy the authorize UI. Ignoring.")}},P=!0,E=!1,O=JSON.parse(Ti.App.Properties.getString("Social-LoadingEstimates","{}")),_=0,N=this;this.showLoadingUI=function(e){f=Ti.UI.createWindow({backgroundColor:"transparent",modal:!0,zIndex:1e3}),Ti.Android||(f.opacity=0,f.transform=Ti.UI.create2DMatrix().scale(0)),I=Ti.UI.createView({top:10,right:10,bottom:10,left:10,backgroundColor:e,borderColor:e,borderRadius:10,borderWidth:4,zIndex:-1});var t=Ti.UI.createButton({font:{fontSize:11,fontWeight:"bold"},backgroundColor:e,borderColor:"#52D3FE",color:"#fff",style:0,borderRadius:6,title:"X",top:8,right:8,width:30,height:30});t.addEventListener("click",x),f.open();var i=0;if(Ti.Android&&(i="10dp"),A=Ti.UI.createView({top:i,right:i,bottom:i,left:i,backgroundColor:"#fff"}),w=Ti.UI.createProgressBar({top:10,right:10,bottom:10,left:10,min:0,max:1,value:.5,message:"Loading, please wait.",backgroundColor:"#fff",font:{fontSize:14,fontWeight:"bold"},style:0}),I.add(A),A.add(w),w.show(),f.add(I),f.add(t),!Ti.Android){var o=Ti.UI.createAnimation({transform:Ti.UI.create2DMatrix().scale(1.1),opacity:1,duration:350}),n=Ti.UI.createAnimation({transform:Ti.UI.create2DMatrix(),duration:400});o.addEventListener("complete",function(){f.animate(n)}),f.animate(o)}r()},this.showAuthorizeUI=function(e,t){console.log("Info: starting oauth webview"),S=t;var i=0;Ti.Android&&(i="10dp"),v=Ti.UI.createWebView({url:e,top:i,right:i,bottom:i,left:i,autoDetect:[Ti.UI.AUTODETECT_NONE]}),v.addEventListener("beforeload",r),v.addEventListener("load",a),I.add(v),v.focus()},this.getAccessToken=function(e,t){m.tokenSecret=h;var i=y(e);i.parameters.push(["oauth_token",u]),i.parameters.push(["oauth_verifier",d]),OAuth.setTimestampAndNonce(i),OAuth.SignatureMethod.sign(i,m);var o=OAuth.getParameterMap(i.parameters),r=Ti.Network.createHTTPClient({onload:function(){var e=OAuth.getParameterMap(this.responseText);Ti.API.info(e.oauth_token),Ti.API.info(e.oauth_token_secret),T=e.oauth_token,g=e.oauth_token_secret,t({success:!0})},onerror:function(){Ti.API.error("Social.js: FAILED to getAccessToken!"),Ti.API.error(this.responseText),t({success:!1})}});r.open("POST",e),r.send(o)},this.Api=function(e,t){var i=e.url;e.onSuccess;var o=e.onError;m.tokenSecret=g;var r=b(i);r.method=e.method,r.parameters.push(["oauth_nonce",OAuth.nonce(42)]),r.parameters.push(["oauth_timestamp",OAuth.timestamp()]),r.parameters.push(["oauth_token",T]),r.parameters.push(["oauth_version","1.0"]),OAuth.SignatureMethod.sign(r,m),OAuth.getParameterMap(r.parameters),client=Ti.Network.createHTTPClient({ondatastream:function(t){console.log(t.progress),e.progress&&(option.progress.setValue=t.progress,1==t.progress&&e.progress.hide())},onload:function(){e.progress&&e.progress.hide(),200==client.status?t&&"function"==typeof t&&t({success:!0,data:JSON.parse(this.responseText)}):(e.progress&&e.progress.hide(),o&&o(this.responseText))},onerror:function(){Ti.API.error("Social.js: FAILED to send a request!"),o&&o(this.responseText)}}),client.open(e.method,i),header=OAuth.getAuthorizationHeader("",r.parameters),client.setRequestHeader("Authorization",header),client.send(),e.progress&&e.progress.show()},this.sendTwitterImage=function(e){var t="https://api.twitter.com/1.1/statuses/update_with_media.json";e.title;var i=e.onSuccess,o=e.onError;if(null==T||null==g)return Ti.API.debug("The send status cannot be processed as the client doesn't have an access token. Authorize before trying to send."),void 0;m.tokenSecret=g;var r=y(t);r.parameters.push(["oauth_token",T]),r.parameters.push(["oauth_timestamp",OAuth.timestamp()]),r.parameters.push(["oauth_nonce",OAuth.nonce(42)]),r.parameters.push(["oauth_version","1.0"]),OAuth.SignatureMethod.sign(r,m),OAuth.getParameterMap(r.parameters),client=Ti.Network.createHTTPClient({onload:function(){200==client.status?i&&i(this.responseText):o&&o(this.responseText)},onerror:function(){Ti.API.error("Social.js: FAILED to send a request!"),Ti.API.error(this.responseText),o&&o(this.responseText)}}),client.open("POST",t),header=OAuth.getAuthorizationHeader(t,r.parameters),client.setRequestHeader("Authorization",header),Ti.Android||client.setRequestHeader("Content-Type","multipart/form-data"),client.send(e.params)},this.getProfileLinkedin=function(){N.Api({method:"GET",url:"http://api.linkedin.com/v1/people/~?format=json"})},this.shareLinkedin=function(e){var t="http://api.linkedin.com/v1/people/~/shares",i=e.onSuccess,o=e.onError;m.tokenSecret=g;var r=y(t);r.parameters.push(["oauth_nonce",OAuth.nonce(42)]),r.parameters.push(["oauth_timestamp",OAuth.timestamp()]),r.parameters.push(["oauth_token",T]),r.parameters.push(["oauth_version","1.0"]),OAuth.SignatureMethod.sign(r,m),client=Ti.Network.createHTTPClient({onload:function(){200==client.status||201==client.status?i&&i(this.responseText):o&&o(this.responseText)},onerror:function(){Ti.API.error("Social.js: FAILED to send a request!"),Ti.API.error(this.responseText),o&&o(this.responseText)}}),client.open("POST",t),header=OAuth.getAuthorizationHeader("",r.parameters),client.setRequestHeader("Content-Type","application/json"),client.setRequestHeader("x-li-format","json"),client.setRequestHeader("Authorization",header);var n=JSON.stringify(e.parameters);client.send(n)},this.send=function(e){var t=e.url,i=e.parameters,o=(e.title,e.onSuccess),r=e.onError;if(null==T||null==g)return Ti.API.debug("The send status cannot be processed as the client doesn't have an access token. Authorize before trying to send."),void 0;m.tokenSecret=g;var n=y(t);n.parameters.push(["oauth_token",T]);for(p in i)n.parameters.push(i[p]);OAuth.setTimestampAndNonce(n),OAuth.SignatureMethod.sign(n,m);var a=OAuth.getParameterMap(n.parameters),s=Ti.Network.createHTTPClient({onload:function(){200==s.status?o&&o(this.responseText):r&&r(this.responseText)},onerror:function(){Ti.API.info(this.responseText),Ti.API.error("Social.js: FAILED to send a request!"),r&&r(this.responseText)}});s.open("POST",t),s.send(a)}};